<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TLS Fingerprint HTTPBin API</title>
  <meta name="description" content="A simple HTTP Request & Response Service with TLS fingerprinting">
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Source+Code+Pro:wght@400;600&family=Open+Sans:wght@400;600;700&display=swap" rel="stylesheet">
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: {
            'sans': ['Open Sans', 'sans-serif'],
            'mono': ['Source Code Pro', 'monospace'],
          },
          colors: {
            'swagger': {
              'bg': '#fafafa',
              'border': '#d8dde7',
              'text': '#3b4151',
              'text-light': '#606060',
              'get': '#61affe',
              'get-bg': '#ebf3fb',
              'get-border': '#61affe',
              'post': '#49cc90',
              'post-bg': '#e8f6f0',
              'post-border': '#49cc90',
              'put': '#fca130',
              'put-bg': '#fbf1e6',
              'put-border': '#fca130',
              'patch': '#50e3c2',
              'patch-bg': '#e9faf6',
              'patch-border': '#50e3c2',
              'delete': '#f93e3e',
              'delete-bg': '#fbe7e7',
              'delete-border': '#f93e3e',
              'code-bg': '#41444e',
              'execute': '#4990e2',
              'section-bg': '#f7f7f7',
            }
          }
        }
      }
    }
  </script>
  <style>
    body { background: #fafafa; }
    .endpoint-row { border-left-width: 3px; }
    .code-block { background: #41444e; color: #fff; }
    .code-block .hljs-string { color: #a5d6a7; }
    .code-block .hljs-attr { color: #80cbc4; }
    .code-block .hljs-number { color: #f48fb1; }

    /* Smooth transitions */
    .endpoint-content {
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.3s ease-out;
    }
    .endpoint-content.open {
      max-height: 5000px;
      transition: max-height 0.5s ease-in;
    }

    /* Table styling */
    .param-table th {
      background: #fafafa;
      font-weight: 600;
      font-size: 12px;
      color: #3b4151;
      text-transform: uppercase;
    }
    .param-table td, .param-table th {
      border: 1px solid #d8dde7;
      padding: 10px;
    }

    /* Response description box */
    .response-desc {
      background: #41444e;
      color: #fff;
      padding: 10px 15px;
      font-family: 'Source Code Pro', monospace;
      font-size: 12px;
    }

    /* Scrollbar */
    ::-webkit-scrollbar { width: 8px; height: 8px; }
    ::-webkit-scrollbar-track { background: #f1f1f1; }
    ::-webkit-scrollbar-thumb { background: #c1c1c1; border-radius: 4px; }
  </style>
</head>
<body class="font-sans text-swagger-text">
  <div class="max-w-5xl mx-auto px-4 py-8">
    <!-- Header -->
    <header class="mb-8 pb-6 border-b border-swagger-border">
      <div class="flex items-center gap-2 mb-2">
        <h1 class="text-4xl font-bold text-swagger-text">tlsfingerprint.com</h1>
        <span class="px-2 py-0.5 text-xs bg-gray-200 text-gray-700 rounded">1.0.0</span>
      </div>
      <p class="text-gray-600 mb-4">[ Base URL: tlsfingerprint.com ]</p>
      <p class="text-swagger-text mb-4">A simple HTTP Request & Response Service with TLS fingerprinting.</p>

      <div class="flex items-center gap-4 mb-4">
        <span class="text-sm text-gray-600">Run locally:</span>
        <code class="bg-gray-800 text-white px-3 py-1 rounded text-sm font-mono">$ docker run -p 8443:8443 tlsfingerprint/httpbin</code>
      </div>

      <div class="flex items-center gap-2">
        <span class="text-sm font-semibold">Schemes</span>
        <select id="scheme-select" class="border border-swagger-border rounded px-2 py-1 text-sm bg-white">
          <option value="https">HTTPS</option>
          <option value="http">HTTP</option>
        </select>
      </div>
    </header>

    <!-- API Sections -->
    <main id="api-sections">
      <div class="flex items-center justify-center py-12 text-gray-500">
        <svg class="w-5 h-5 animate-spin mr-2" fill="none" viewBox="0 0 24 24">
          <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
          <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"></path>
        </svg>
        Loading...
      </div>
    </main>
  </div>

  <script>
    // Method colors configuration
    const methodConfig = {
      get: { bg: 'bg-swagger-get-bg', border: 'border-swagger-get', badge: 'bg-swagger-get', hoverBg: 'hover:bg-swagger-get-bg' },
      post: { bg: 'bg-swagger-post-bg', border: 'border-swagger-post', badge: 'bg-swagger-post', hoverBg: 'hover:bg-swagger-post-bg' },
      put: { bg: 'bg-swagger-put-bg', border: 'border-swagger-put', badge: 'bg-swagger-put', hoverBg: 'hover:bg-swagger-put-bg' },
      patch: { bg: 'bg-swagger-patch-bg', border: 'border-swagger-patch', badge: 'bg-swagger-patch', hoverBg: 'hover:bg-swagger-patch-bg' },
      delete: { bg: 'bg-swagger-delete-bg', border: 'border-swagger-delete', badge: 'bg-swagger-delete', hoverBg: 'hover:bg-swagger-delete-bg' },
    };

    // State management
    const state = {
      expandedEndpoints: new Set(),
      tryItOutMode: {},
      responses: {},
    };

    // Generate curl command
    function generateCurl(method, url, headers = {}) {
      let cmd = `curl -X ${method.toUpperCase()} "${url}"`;
      Object.entries(headers).forEach(([key, val]) => {
        cmd += ` \\\n  -H "${key}: ${val}"`;
      });
      return cmd;
    }

    // Download response as JSON
    function downloadResponse(id) {
      const data = state.responses[id];
      if (!data) return;
      const blob = new Blob([JSON.stringify(data.body, null, 2)], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'response.json';
      a.click();
      URL.revokeObjectURL(url);
    }

    // Format JSON with syntax highlighting
    function formatJson(obj) {
      const json = JSON.stringify(obj, null, 2);
      return json
        .replace(/&/g, '&amp;')
        .replace(/</g, '&lt;')
        .replace(/>/g, '&gt;')
        .replace(/"([^"]+)":/g, '<span class="text-cyan-300">"$1"</span>:')
        .replace(/: "([^"]*)"/g, ': <span class="text-green-300">"$1"</span>')
        .replace(/: (\d+)/g, ': <span class="text-pink-300">$1</span>')
        .replace(/: (true|false|null)/g, ': <span class="text-yellow-300">$1</span>');
    }

    // Build endpoint HTML
    function buildEndpoint(path, method, details, id) {
      const config = methodConfig[method] || methodConfig.get;
      const params = details.parameters || [];
      const hasParams = params.length > 0;
      const summary = details.summary || '';
      const description = details.description || summary;

      return `
        <div class="endpoint-row border ${config.border} ${config.bg} rounded mb-1" data-id="${id}">
          <!-- Header Row -->
          <div class="flex items-center gap-3 px-4 py-2 cursor-pointer ${config.hoverBg}" onclick="toggleEndpoint('${id}')">
            <span class="${config.badge} text-white text-xs font-bold uppercase px-3 py-1 rounded min-w-[80px] text-center">
              ${method}
            </span>
            <span class="font-mono text-base text-swagger-text font-semibold">${path}</span>
            <span class="text-gray-500 text-sm flex-1">${summary}</span>
            <svg class="w-4 h-4 text-gray-400 transform transition-transform" id="${id}-chevron" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
            </svg>
          </div>

          <!-- Expanded Content -->
          <div class="endpoint-content border-t border-swagger-border bg-white" id="${id}-content">
            <div class="p-4">
              ${description ? `<p class="text-sm text-gray-600 mb-4">${description}</p>` : ''}

              <!-- Parameters Section -->
              <div class="mb-4" id="${id}-params-section">
                <div class="flex items-center justify-between mb-2">
                  <h4 class="text-sm font-semibold text-swagger-text">Parameters</h4>
                  <button onclick="toggleTryItOut('${id}')" id="${id}-try-btn" class="px-4 py-1 text-sm border border-swagger-border text-swagger-text rounded hover:bg-gray-50">
                    Try it out
                  </button>
                </div>

                ${hasParams ? `
                  <table class="param-table w-full text-sm border-collapse">
                    <thead>
                      <tr>
                        <th class="text-left w-1/3">Name</th>
                        <th class="text-left">Description</th>
                      </tr>
                    </thead>
                    <tbody>
                      ${params.map(p => `
                        <tr>
                          <td class="align-top">
                            <div class="font-semibold text-swagger-text">${p.name}</div>
                            <div class="text-xs text-gray-500">${p.schema?.type || 'string'}</div>
                            <div class="text-xs text-gray-400">(${p.in})</div>
                            ${p.required ? '<div class="text-xs text-red-500">* required</div>' : ''}
                          </td>
                          <td>
                            <input type="text"
                              id="${id}-param-${p.name}"
                              class="param-input w-full border border-swagger-border rounded px-3 py-2 text-sm font-mono hidden"
                              placeholder="${p.schema?.type || 'value'}"
                              ${p.schema?.minimum ? `min="${p.schema.minimum}"` : ''}
                              ${p.schema?.maximum ? `max="${p.schema.maximum}"` : ''}
                            >
                            <span class="param-desc text-gray-500 text-sm">${p.description || '-'}</span>
                          </td>
                        </tr>
                      `).join('')}
                    </tbody>
                  </table>
                ` : '<p class="text-sm text-gray-500">No parameters</p>'}
              </div>

              <!-- Execute/Clear Buttons (hidden initially) -->
              <div class="hidden mb-4" id="${id}-execute-section">
                <div class="flex gap-0">
                  <button onclick="executeRequest('${path}', '${method}', '${id}')"
                    class="flex-1 bg-swagger-execute text-white font-bold py-2 px-4 text-sm hover:opacity-90">
                    Execute
                  </button>
                  <button onclick="clearResponse('${id}')"
                    class="flex-1 bg-gray-400 text-white font-bold py-2 px-4 text-sm hover:opacity-90">
                    Clear
                  </button>
                </div>
              </div>

              <!-- Response Display (hidden initially) -->
              <div class="hidden" id="${id}-response-display">
                <!-- Curl -->
                <div class="mb-4">
                  <h5 class="text-sm font-semibold text-swagger-text mb-2">Curl</h5>
                  <pre class="code-block rounded p-4 text-sm font-mono overflow-x-auto whitespace-pre-wrap" id="${id}-curl"></pre>
                </div>

                <!-- Request URL -->
                <div class="mb-4">
                  <h5 class="text-sm font-semibold text-swagger-text mb-2">Request URL</h5>
                  <div class="bg-swagger-get-bg border border-swagger-get rounded px-4 py-2 font-mono text-sm" id="${id}-request-url"></div>
                </div>

                <!-- Server Response -->
                <div class="mb-4">
                  <h5 class="text-sm font-semibold text-swagger-text mb-2">Server response</h5>
                  <table class="w-full border-collapse text-sm">
                    <thead>
                      <tr class="border-b border-swagger-border">
                        <th class="text-left py-2 w-20 text-swagger-text">Code</th>
                        <th class="text-left py-2 text-swagger-text">Details</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr>
                        <td class="py-3 align-top font-semibold" id="${id}-status-code">-</td>
                        <td class="py-3">
                          <!-- Response Body -->
                          <div class="mb-4">
                            <div class="flex items-center justify-between mb-2">
                              <span class="text-sm font-semibold text-swagger-text">Response body</span>
                              <button onclick="downloadResponse('${id}')" class="px-3 py-1 text-xs border border-swagger-border rounded hover:bg-gray-50">
                                Download
                              </button>
                            </div>
                            <pre class="code-block rounded p-4 text-sm font-mono overflow-x-auto max-h-80" id="${id}-response-body"></pre>
                          </div>

                          <!-- Response Headers -->
                          <div>
                            <span class="text-sm font-semibold text-swagger-text block mb-2">Response headers</span>
                            <pre class="code-block rounded p-4 text-sm font-mono overflow-x-auto" id="${id}-response-headers"></pre>
                          </div>
                        </td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>

              <!-- Responses Section -->
              <div class="border-t border-swagger-border pt-4">
                <div class="flex items-center justify-between mb-2">
                  <h4 class="text-sm font-semibold text-swagger-text">Responses</h4>
                  <div class="flex items-center gap-2">
                    <span class="text-xs text-gray-500">Response content type</span>
                    <select class="border border-swagger-border rounded px-2 py-1 text-xs bg-white">
                      <option>application/json</option>
                    </select>
                  </div>
                </div>
                <table class="w-full border-collapse text-sm">
                  <thead>
                    <tr class="border-b border-swagger-border">
                      <th class="text-left py-2 w-20 text-swagger-text">Code</th>
                      <th class="text-left py-2 text-swagger-text">Description</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td class="py-3 align-top font-semibold">200</td>
                      <td class="py-3">
                        <div class="response-desc rounded">${summary || 'Successful response'}</div>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
      `;
    }

    // Build section HTML
    function buildSection(tag, endpoints, tagIndex) {
      const tagDescriptions = {
        'HTTP Methods': 'Testing different HTTP verbs',
        'Request Inspection': 'Inspect request details',
        'Compression': 'Compressed responses',
        'Cookies': 'Cookie operations',
        'Images': 'Binary image responses',
        'Response Formats': 'Different response formats',
        'Redirects': 'Redirect operations',
        'Dynamic': 'Dynamic response generation',
      };

      const sectionId = `section-${tagIndex}`;
      const desc = tagDescriptions[tag] || '';

      return `
        <section class="mb-4 border border-swagger-border rounded bg-white" data-section="${sectionId}">
          <button onclick="toggleSection('${sectionId}')"
            class="w-full flex items-center justify-between px-4 py-3 hover:bg-gray-50 text-left">
            <div>
              <span class="text-lg font-bold text-swagger-text">${tag}</span>
              <span class="text-sm text-gray-500 ml-2">${desc}</span>
            </div>
            <svg class="w-5 h-5 text-gray-400 transform transition-transform" id="${sectionId}-chevron" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
            </svg>
          </button>
          <div class="border-t border-swagger-border p-3 hidden" id="${sectionId}-content">
            ${endpoints.map((e, i) => buildEndpoint(e.path, e.method, e.details, `${tagIndex}-${i}`)).join('')}
          </div>
        </section>
      `;
    }

    // Toggle section
    function toggleSection(id) {
      const content = document.getElementById(`${id}-content`);
      const chevron = document.getElementById(`${id}-chevron`);
      content.classList.toggle('hidden');
      chevron.classList.toggle('rotate-90');
    }

    // Toggle endpoint
    function toggleEndpoint(id) {
      const content = document.getElementById(`${id}-content`);
      const chevron = document.getElementById(`${id}-chevron`);

      if (state.expandedEndpoints.has(id)) {
        content.classList.remove('open');
        chevron.classList.remove('rotate-180');
        state.expandedEndpoints.delete(id);
      } else {
        content.classList.add('open');
        chevron.classList.add('rotate-180');
        state.expandedEndpoints.add(id);
      }
    }

    // Toggle try it out mode
    function toggleTryItOut(id) {
      const btn = document.getElementById(`${id}-try-btn`);
      const executeSection = document.getElementById(`${id}-execute-section`);
      const paramsSection = document.getElementById(`${id}-params-section`);
      const paramInputs = paramsSection.querySelectorAll('.param-input');
      const paramDescs = paramsSection.querySelectorAll('.param-desc');

      state.tryItOutMode[id] = !state.tryItOutMode[id];

      if (state.tryItOutMode[id]) {
        btn.textContent = 'Cancel';
        btn.classList.add('border-swagger-delete', 'text-swagger-delete');
        btn.classList.remove('border-swagger-border', 'text-swagger-text');
        executeSection.classList.remove('hidden');
        paramInputs.forEach(el => el.classList.remove('hidden'));
        paramDescs.forEach(el => el.classList.add('hidden'));
      } else {
        btn.textContent = 'Try it out';
        btn.classList.remove('border-swagger-delete', 'text-swagger-delete');
        btn.classList.add('border-swagger-border', 'text-swagger-text');
        executeSection.classList.add('hidden');
        paramInputs.forEach(el => {
          el.classList.add('hidden');
          el.value = '';  // Reset input values
        });
        paramDescs.forEach(el => el.classList.remove('hidden'));
        // Hide response display and clear state
        document.getElementById(`${id}-response-display`).classList.add('hidden');
        delete state.responses[id];
      }
    }

    // Clear response
    function clearResponse(id) {
      document.getElementById(`${id}-response-display`).classList.add('hidden');
      delete state.responses[id];
    }

    // Execute request
    async function executeRequest(path, method, id) {
      const scheme = document.getElementById('scheme-select').value;
      const baseUrl = window.location.origin;

      // Build URL with parameters
      let url = path;
      const params = document.querySelectorAll(`[id^="${id}-param-"]`);
      const queryParams = [];

      params.forEach(input => {
        const paramName = input.id.replace(`${id}-param-`, '');
        const value = input.value.trim();
        if (value) {
          if (url.includes(`{${paramName}}`)) {
            url = url.replace(`{${paramName}}`, encodeURIComponent(value));
          } else {
            queryParams.push(`${paramName}=${encodeURIComponent(value)}`);
          }
        }
      });

      if (queryParams.length > 0) {
        url += (url.includes('?') ? '&' : '?') + queryParams.join('&');
      }

      const fullUrl = baseUrl + url;
      const headers = { 'Accept': 'application/json' };

      // Show response section
      const responseDisplay = document.getElementById(`${id}-response-display`);
      responseDisplay.classList.remove('hidden');

      // Update curl
      document.getElementById(`${id}-curl`).textContent = generateCurl(method, fullUrl, headers);
      document.getElementById(`${id}-request-url`).textContent = fullUrl;

      // Loading state
      document.getElementById(`${id}-status-code`).textContent = '...';
      document.getElementById(`${id}-response-body`).innerHTML = 'Loading...';
      document.getElementById(`${id}-response-headers`).textContent = '';

      try {
        const options = { method: method.toUpperCase(), headers };
        const response = await fetch(fullUrl, options);

        // Collect headers
        const responseHeaders = [];
        response.headers.forEach((value, key) => {
          responseHeaders.push(`${key}: ${value}`);
        });

        // Status
        document.getElementById(`${id}-status-code`).textContent = response.status;

        // Body
        const contentType = response.headers.get('content-type') || '';
        let bodyText;
        let bodyJson;

        if (contentType.includes('application/json')) {
          bodyJson = await response.json();
          bodyText = formatJson(bodyJson);
        } else if (contentType.includes('image/')) {
          bodyText = `[Binary image data - ${contentType}]`;
          bodyJson = { type: contentType, size: 'binary' };
        } else {
          bodyText = await response.text();
          bodyJson = { text: bodyText };
        }

        document.getElementById(`${id}-response-body`).innerHTML = bodyText;
        document.getElementById(`${id}-response-headers`).textContent = responseHeaders.join('\n');

        // Store for download
        state.responses[id] = { body: bodyJson, headers: responseHeaders };

      } catch (error) {
        document.getElementById(`${id}-status-code`).textContent = 'Error';
        document.getElementById(`${id}-response-body`).textContent = error.message;
      }
    }

    // Load OpenAPI spec
    async function loadSpec() {
      try {
        const response = await fetch('/openapi.json');
        const spec = await response.json();

        // Group endpoints by tag
        const grouped = {};
        const tagOrder = (spec.tags || []).map(t => t.name);

        for (const [path, methods] of Object.entries(spec.paths || {})) {
          for (const [method, details] of Object.entries(methods)) {
            const tags = details.tags || ['Other'];
            tags.forEach(tag => {
              if (!grouped[tag]) grouped[tag] = [];
              grouped[tag].push({ path, method, details });
            });
          }
        }

        // Render
        const container = document.getElementById('api-sections');
        container.innerHTML = '';

        const renderedTags = new Set();
        let tagIndex = 0;

        tagOrder.forEach(tag => {
          if (grouped[tag]) {
            container.innerHTML += buildSection(tag, grouped[tag], tagIndex++);
            renderedTags.add(tag);
          }
        });

        Object.keys(grouped).forEach(tag => {
          if (!renderedTags.has(tag)) {
            container.innerHTML += buildSection(tag, grouped[tag], tagIndex++);
          }
        });

        // Expand first section
        if (tagIndex > 0) toggleSection('section-0');

      } catch (error) {
        document.getElementById('api-sections').innerHTML = `
          <div class="text-center py-12 text-red-500">
            Failed to load API specification: ${error.message}
          </div>
        `;
      }
    }

    // Initialize
    document.addEventListener('DOMContentLoaded', loadSpec);
  </script>
</body>
</html>
